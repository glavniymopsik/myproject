<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–î–µ—Ç–µ–∫—Ç–æ—Ä –¥–µ—Ñ–µ–∫—Ç–æ–≤ –¥–æ—Ä–æ–≥–∏</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
</head>
<body>

  <header>
    <div class="header-content">
      <h1>–î–µ—Ç–µ–∫—Ç–æ—Ä –¥–µ—Ñ–µ–∫—Ç–æ–≤ –¥–æ—Ä–æ–≥–∏</h1>
    </div>
  </header>

  <main>
    <div class="content">
      <label for="file-upload" class="upload-btn">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</label>
      <input type="file" id="file-upload" accept="image/*" onchange="handleFile(event)" />
      
      <div id="file-name-container" class="file-name-container" style="display:none;">
        <p id="file-name"></p>
      </div>

      <img id="preview" class="preview-image" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" style="display:none; max-width: 100%;"/>

      <div class="action-buttons">
        <button id="process-btn" disabled>–û–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
        <button id="reset-btn" disabled>–°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ç–æ</button>
      </div>

      <div id="result-container" style="margin-top: 20px;">
        <h3 style="display:none;" id="result-title">–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏:</h3>
        <img id="result-image" class="preview-image" src="" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç" style="display:none; max-width: 100%;"/>
        <button id="fullscreen-btn" class="fullscreen-btn" style="display:none;">–ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω</button>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 –î–æ—Ä–æ–∂–Ω–∞—è –ò–Ω—Å–ø–µ–∫—Ü–∏—è | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
  </footer>

  <script>
    function handleFile(event) {
      const file = event.target.files[0];
      const fileNameElem = document.getElementById('file-name');
      const fileNameContainer = document.getElementById('file-name-container');
      const processBtn = document.getElementById('process-btn');
      const resetBtn = document.getElementById('reset-btn');
      const preview = document.getElementById('preview');

      if (file) {
        fileNameElem.textContent = `–§–∞–π–ª –≤—ã–±—Ä–∞–Ω: ${file.name}`;
        fileNameContainer.style.display = 'block';
        processBtn.disabled = false;
        resetBtn.disabled = false;

        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    document.getElementById('reset-btn').addEventListener('click', () => {
      document.getElementById('file-upload').value = '';
      document.getElementById('file-name').textContent = '';
      document.getElementById('file-name-container').style.display = 'none';
      document.getElementById('process-btn').disabled = true;
      document.getElementById('reset-btn').disabled = true;
      document.getElementById('preview').style.display = 'none';
      document.getElementById('result-image').style.display = 'none';
      document.getElementById('result-title').style.display = 'none';
      document.getElementById('fullscreen-btn').style.display = 'none';
    });

    document.getElementById('process-btn').addEventListener('click', async () => {
      const fileInput = document.getElementById('file-upload');
      const file = fileInput.files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append('image', file);

      try {
        const response = await fetch('/process', {
          method: 'POST',
          body: formData,
        });

        const data = await response.json();
        if (data.result) {
          const resultImage = document.getElementById('result-image');
          const resultTitle = document.getElementById('result-title');
          resultImage.src = data.result + '?t=' + new Date().getTime(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞
          resultImage.style.display = 'block';
          resultTitle.style.display = 'block';
          document.getElementById('fullscreen-btn').style.display = 'inline-block';
        } else {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
      }
    });

    // –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
    document.getElementById('fullscreen-btn').addEventListener('click', function() {
      const image = document.getElementById('result-image');
      if (image.requestFullscreen) {
        image.requestFullscreen();
      } else if (image.msRequestFullscreen) { /* –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π IE */
        image.msRequestFullscreen();
      } else if (image.mozRequestFullScreen) { /* Firefox */
        image.mozRequestFullScreen();
      } else if (image.webkitRequestFullscreen) { /* Chrome, Safari –∏ Opera */
        image.webkitRequestFullscreen();
      }
    });
  </script>

</body>
</html>
